import { ImageResponse } from "@vercel/og";
import { NextRequest } from "next/server";

export const config = {
  runtime: "edge"
};


export default function handler(req: NextRequest) {
  try {
    const { searchParams } = new URL(req.url);
    const hasTitle = searchParams.has("name");
    const universityName = hasTitle
      ? searchParams.get("name")?.slice(0, 100)
      : "UniversitÃ© de Rennes";

    return new ImageResponse(
      (
        <div style={{ backgroundColor: "#7B71D6" }}
             tw="flex flex-col items-center justify-center bg-white h-full w-full">
          <svg
            style={{ marginBottom: "10px" }}
            height={30}
            fill="#fff"
            viewBox="0 0 484 73"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M169.359 53.8594C169.359 52.7969 169.203 51.8438 168.891 51C168.578 50.125 168 49.3125 167.156 48.5625C166.312 47.8125 165.094 47.0625 163.5 46.3125C161.938 45.5312 159.875 44.7188 157.312 43.875C154.312 42.875 151.422 41.75 148.641 40.5C145.859 39.2188 143.375 37.7344 141.188 36.0469C139 34.3281 137.266 32.3281 135.984 30.0469C134.703 27.7344 134.062 25.0469 134.062 21.9844C134.062 19.0469 134.719 16.4062 136.031 14.0625C137.344 11.6875 139.172 9.67188 141.516 8.01562C143.891 6.32812 146.672 5.04688 149.859 4.17188C153.047 3.26562 156.531 2.8125 160.312 2.8125C165.312 2.8125 169.719 3.6875 173.531 5.4375C177.375 7.15625 180.375 9.60938 182.531 12.7969C184.719 15.9531 185.812 19.6875 185.812 24H169.453C169.453 22.2812 169.094 20.7656 168.375 19.4531C167.688 18.1406 166.641 17.1094 165.234 16.3594C163.828 15.6094 162.062 15.2344 159.938 15.2344C157.875 15.2344 156.141 15.5469 154.734 16.1719C153.328 16.7969 152.266 17.6406 151.547 18.7031C150.828 19.7344 150.469 20.875 150.469 22.125C150.469 23.1562 150.75 24.0938 151.312 24.9375C151.906 25.75 152.734 26.5156 153.797 27.2344C154.891 27.9531 156.203 28.6406 157.734 29.2969C159.297 29.9531 161.047 30.5938 162.984 31.2188C166.609 32.375 169.828 33.6719 172.641 35.1094C175.484 36.5156 177.875 38.125 179.812 39.9375C181.781 41.7188 183.266 43.75 184.266 46.0312C185.297 48.3125 185.812 50.8906 185.812 53.7656C185.812 56.8281 185.219 59.5469 184.031 61.9219C182.844 64.2969 181.141 66.3125 178.922 67.9688C176.703 69.5938 174.047 70.8281 170.953 71.6719C167.859 72.5156 164.406 72.9375 160.594 72.9375C157.094 72.9375 153.641 72.5 150.234 71.625C146.859 70.7188 143.797 69.3438 141.047 67.5C138.297 65.625 136.094 63.2344 134.438 60.3281C132.812 57.3906 132 53.9062 132 49.875H148.5C148.5 51.875 148.766 53.5625 149.297 54.9375C149.828 56.3125 150.609 57.4219 151.641 58.2656C152.672 59.0781 153.938 59.6719 155.438 60.0469C156.938 60.3906 158.656 60.5625 160.594 60.5625C162.688 60.5625 164.375 60.2656 165.656 59.6719C166.938 59.0469 167.875 58.2344 168.469 57.2344C169.062 56.2031 169.359 55.0781 169.359 53.8594Z" />
            <path
              d="M214.969 60.75C216.438 60.75 217.688 60.4844 218.719 59.9531C219.781 59.3906 220.578 58.6094 221.109 57.6094C221.672 56.5781 221.938 55.3438 221.906 53.9062H236.766C236.797 57.7188 235.859 61.0625 233.953 63.9375C232.078 66.7812 229.516 69 226.266 70.5938C223.047 72.1562 219.406 72.9375 215.344 72.9375C211.375 72.9375 207.906 72.2969 204.938 71.0156C201.969 69.7031 199.484 67.8906 197.484 65.5781C195.516 63.2344 194.031 60.5 193.031 57.375C192.062 54.25 191.578 50.8594 191.578 47.2031V46.125C191.578 42.4688 192.062 39.0781 193.031 35.9531C194.031 32.7969 195.516 30.0625 197.484 27.75C199.484 25.4062 201.953 23.5938 204.891 22.3125C207.859 21 211.312 20.3438 215.25 20.3438C219.469 20.3438 223.188 21.1406 226.406 22.7344C229.656 24.3281 232.203 26.6406 234.047 29.6719C235.891 32.7031 236.797 36.375 236.766 40.6875H221.906C221.938 39.1562 221.703 37.7812 221.203 36.5625C220.703 35.3438 219.922 34.375 218.859 33.6562C217.828 32.9062 216.5 32.5312 214.875 32.5312C213.25 32.5312 211.938 32.8906 210.938 33.6094C209.938 34.3281 209.172 35.3281 208.641 36.6094C208.141 37.8594 207.797 39.2969 207.609 40.9219C207.453 42.5469 207.375 44.2812 207.375 46.125V47.2031C207.375 49.0781 207.453 50.8438 207.609 52.5C207.797 54.125 208.156 55.5625 208.688 56.8125C209.219 58.0312 209.984 59 210.984 59.7188C211.984 60.4062 213.312 60.75 214.969 60.75Z" />
            <path
              d="M258.984 0V72H243.188V0H258.984ZM257.109 44.9062L253.406 45C253.406 41.4375 253.844 38.1562 254.719 35.1562C255.594 32.1562 256.844 29.5469 258.469 27.3281C260.094 25.1094 262.047 23.3906 264.328 22.1719C266.609 20.9531 269.141 20.3438 271.922 20.3438C274.422 20.3438 276.703 20.7031 278.766 21.4219C280.859 22.1406 282.656 23.2969 284.156 24.8906C285.688 26.4844 286.859 28.5625 287.672 31.125C288.516 33.6875 288.938 36.8125 288.938 40.5V72H273.047V40.4062C273.047 38.3438 272.75 36.75 272.156 35.625C271.594 34.4688 270.781 33.6719 269.719 33.2344C268.656 32.7656 267.359 32.5312 265.828 32.5312C263.984 32.5312 262.484 32.8438 261.328 33.4688C260.172 34.0938 259.281 34.9688 258.656 36.0938C258.062 37.1875 257.656 38.4844 257.438 39.9844C257.219 41.4844 257.109 43.125 257.109 44.9062Z" />
            <path
              d="M295.734 47.1562V46.1719C295.734 42.4531 296.266 39.0312 297.328 35.9062C298.391 32.75 299.953 30.0156 302.016 27.7031C304.078 25.3906 306.625 23.5938 309.656 22.3125C312.688 21 316.188 20.3438 320.156 20.3438C324.156 20.3438 327.672 21 330.703 22.3125C333.766 23.5938 336.328 25.3906 338.391 27.7031C340.453 30.0156 342.016 32.75 343.078 35.9062C344.141 39.0312 344.672 42.4531 344.672 46.1719V47.1562C344.672 50.8438 344.141 54.2656 343.078 57.4219C342.016 60.5469 340.453 63.2812 338.391 65.625C336.328 67.9375 333.781 69.7344 330.75 71.0156C327.719 72.2969 324.219 72.9375 320.25 72.9375C316.281 72.9375 312.766 72.2969 309.703 71.0156C306.641 69.7344 304.078 67.9375 302.016 65.625C299.953 63.2812 298.391 60.5469 297.328 57.4219C296.266 54.2656 295.734 50.8438 295.734 47.1562ZM311.531 46.1719V47.1562C311.531 49.0625 311.672 50.8438 311.953 52.5C312.234 54.1562 312.703 55.6094 313.359 56.8594C314.016 58.0781 314.906 59.0312 316.031 59.7188C317.156 60.4062 318.562 60.75 320.25 60.75C321.906 60.75 323.281 60.4062 324.375 59.7188C325.5 59.0312 326.391 58.0781 327.047 56.8594C327.703 55.6094 328.172 54.1562 328.453 52.5C328.734 50.8438 328.875 49.0625 328.875 47.1562V46.1719C328.875 44.3281 328.734 42.5938 328.453 40.9688C328.172 39.3125 327.703 37.8594 327.047 36.6094C326.391 35.3281 325.5 34.3281 324.375 33.6094C323.25 32.8906 321.844 32.5312 320.156 32.5312C318.5 32.5312 317.109 32.8906 315.984 33.6094C314.891 34.3281 314.016 35.3281 313.359 36.6094C312.703 37.8594 312.234 39.3125 311.953 40.9688C311.672 42.5938 311.531 44.3281 311.531 46.1719Z" />
            <path
              d="M329.562 47.1562V46.1719C329.562 42.4531 330.094 39.0312 331.156 35.9062C332.219 32.75 333.781 30.0156 335.844 27.7031C337.906 25.3906 340.453 23.5938 343.484 22.3125C346.516 21 350.016 20.3438 353.984 20.3438C357.984 20.3438 361.5 21 364.531 22.3125C367.594 23.5938 370.156 25.3906 372.219 27.7031C374.281 30.0156 375.844 32.75 376.906 35.9062C377.969 39.0312 378.5 42.4531 378.5 46.1719V47.1562C378.5 50.8438 377.969 54.2656 376.906 57.4219C375.844 60.5469 374.281 63.2812 372.219 65.625C370.156 67.9375 367.609 69.7344 364.578 71.0156C361.547 72.2969 358.047 72.9375 354.078 72.9375C350.109 72.9375 346.594 72.2969 343.531 71.0156C340.469 69.7344 337.906 67.9375 335.844 65.625C333.781 63.2812 332.219 60.5469 331.156 57.4219C330.094 54.2656 329.562 50.8438 329.562 47.1562ZM345.359 46.1719V47.1562C345.359 49.0625 345.5 50.8438 345.781 52.5C346.062 54.1562 346.531 55.6094 347.188 56.8594C347.844 58.0781 348.734 59.0312 349.859 59.7188C350.984 60.4062 352.391 60.75 354.078 60.75C355.734 60.75 357.109 60.4062 358.203 59.7188C359.328 59.0312 360.219 58.0781 360.875 56.8594C361.531 55.6094 362 54.1562 362.281 52.5C362.562 50.8438 362.703 49.0625 362.703 47.1562V46.1719C362.703 44.3281 362.562 42.5938 362.281 40.9688C362 39.3125 361.531 37.8594 360.875 36.6094C360.219 35.3281 359.328 34.3281 358.203 33.6094C357.078 32.8906 355.672 32.5312 353.984 32.5312C352.328 32.5312 350.938 32.8906 349.812 33.6094C348.719 34.3281 347.844 35.3281 347.188 36.6094C346.531 37.8594 346.062 39.3125 345.781 40.9688C345.5 42.5938 345.359 44.3281 345.359 46.1719Z" />
            <path d="M401.844 0V72H386V0H401.844Z" />
            <path
              d="M428.281 21.2812V72H412.438V21.2812H428.281ZM411.5 8.20312C411.5 5.95312 412.312 4.10938 413.938 2.67188C415.562 1.23438 417.672 0.515625 420.266 0.515625C422.859 0.515625 424.969 1.23438 426.594 2.67188C428.219 4.10938 429.031 5.95312 429.031 8.20312C429.031 10.4531 428.219 12.2969 426.594 13.7344C424.969 15.1719 422.859 15.8906 420.266 15.8906C417.672 15.8906 415.562 15.1719 413.938 13.7344C412.312 12.2969 411.5 10.4531 411.5 8.20312Z" />
            <path
              d="M467.656 59.6719V21.2812H483.5V72H468.688L467.656 59.6719ZM469.156 49.3594L473.281 49.2656C473.281 52.6719 472.875 55.8281 472.062 58.7344C471.25 61.6094 470.047 64.1094 468.453 66.2344C466.891 68.3594 464.953 70.0156 462.641 71.2031C460.359 72.3594 457.719 72.9375 454.719 72.9375C452.219 72.9375 449.922 72.5938 447.828 71.9062C445.766 71.1875 443.984 70.0781 442.484 68.5781C440.984 67.0469 439.812 65.0938 438.969 62.7188C438.156 60.3125 437.75 57.4375 437.75 54.0938V21.2812H453.547V54.1875C453.547 55.3125 453.688 56.2812 453.969 57.0938C454.25 57.9062 454.656 58.5938 455.188 59.1562C455.719 59.6875 456.375 60.0938 457.156 60.375C457.969 60.625 458.891 60.75 459.922 60.75C462.297 60.75 464.156 60.25 465.5 59.25C466.844 58.25 467.781 56.8906 468.312 55.1719C468.875 53.4531 469.156 51.5156 469.156 49.3594Z" />
            <circle cx="356.5" cy="53.5" r="3.5" />
            <circle cx="322.5" cy="53.5" r="3.5" />
            <path
              d="M0 37.0086V35.6499C0 30.517 0.73327 25.7939 2.19981 21.4805C3.66635 17.124 5.82303 13.3498 8.66984 10.1579C11.5167 6.96607 15.032 4.48589 19.216 2.71741C23.3999 0.905804 28.2309 0 33.7089 0C39.23 0 44.0825 0.905804 48.2664 2.71741C52.4935 4.48589 56.0305 6.96607 58.8773 10.1579C61.7241 13.3498 63.8808 17.124 65.3473 21.4805C66.8139 25.7939 67.5471 30.517 67.5471 35.6499V37.0086C67.5471 42.0983 66.8139 46.8215 65.3473 51.1779C63.8808 55.4913 61.7241 59.2655 58.8773 62.5005C56.0305 65.6924 52.5151 68.1726 48.3311 69.941C44.1472 71.7095 39.3162 72.5938 33.8383 72.5938C28.3603 72.5938 23.5078 71.7095 19.2807 69.941C15.0536 68.1726 11.5167 65.6924 8.66984 62.5005C5.82303 59.2655 3.66635 55.4913 2.19981 51.1779C0.73327 46.8215 0 42.0983 0 37.0086ZM21.804 35.6499V37.0086C21.804 39.6397 21.9981 42.0983 22.3863 44.3844C22.7745 46.6705 23.4215 48.6762 24.3273 50.4015C25.2331 52.0838 26.4624 53.3993 28.0152 54.3483C29.568 55.2972 31.5091 55.7717 33.8383 55.7717C36.1243 55.7717 38.0222 55.2972 39.5319 54.3483C41.0847 53.3993 42.314 52.0838 43.2198 50.4015C44.1256 48.6762 44.7726 46.6705 45.1608 44.3844C45.549 42.0983 45.7431 39.6397 45.7431 37.0086V35.6499C45.7431 33.105 45.549 30.7111 45.1608 28.4681C44.7726 26.1821 44.1256 24.1763 43.2198 22.451C42.314 20.6825 41.0847 19.3023 39.5319 18.3102C37.9791 17.3181 36.0381 16.8221 33.7089 16.8221C31.4228 16.8221 29.5033 17.3181 27.9505 18.3102C26.4409 19.3023 25.2331 20.6825 24.3273 22.451C23.4215 24.1763 22.7745 26.1821 22.3863 28.4681C21.9981 30.7111 21.804 33.105 21.804 35.6499Z" />
            <path
              d="M46.6921 37.0086V35.6499C46.6921 30.517 47.4253 25.7939 48.8919 21.4805C50.3584 17.124 52.5151 13.3498 55.3619 10.1579C58.2087 6.96607 61.7241 4.48589 65.9081 2.71741C70.092 0.905804 74.923 0 80.4009 0C85.922 0 90.7745 0.905804 94.9585 2.71741C99.1856 4.48589 102.723 6.96607 105.569 10.1579C108.416 13.3498 110.573 17.124 112.039 21.4805C113.506 25.7939 114.239 30.517 114.239 35.6499V37.0086C114.239 42.0983 113.506 46.8215 112.039 51.1779C110.573 55.4913 108.416 59.2655 105.569 62.5005C102.723 65.6924 99.2071 68.1726 95.0232 69.941C90.8392 71.7095 86.0083 72.5938 80.5303 72.5938C75.0524 72.5938 70.1998 71.7095 65.9728 69.941C61.7457 68.1726 58.2087 65.6924 55.3619 62.5005C52.5151 59.2655 50.3584 55.4913 48.8919 51.1779C47.4253 46.8215 46.6921 42.0983 46.6921 37.0086ZM68.4961 35.6499V37.0086C68.4961 39.6397 68.6902 42.0983 69.0784 44.3844C69.4666 46.6705 70.1136 48.6762 71.0194 50.4015C71.9252 52.0838 73.1545 53.3993 74.7073 54.3483C76.2601 55.2972 78.2011 55.7717 80.5303 55.7717C82.8164 55.7717 84.7143 55.2972 86.224 54.3483C87.7768 53.3993 89.0061 52.0838 89.9119 50.4015C90.8177 48.6762 91.4647 46.6705 91.8529 44.3844C92.2411 42.0983 92.4352 39.6397 92.4352 37.0086V35.6499C92.4352 33.105 92.2411 30.7111 91.8529 28.4681C91.4647 26.1821 90.8177 24.1763 89.9119 22.451C89.0061 20.6825 87.7768 19.3023 86.224 18.3102C84.6711 17.3181 82.7301 16.8221 80.4009 16.8221C78.1148 16.8221 76.1954 17.3181 74.6426 18.3102C73.1329 19.3023 71.9252 20.6825 71.0194 22.451C70.1136 24.1763 69.4666 26.1821 69.0784 28.4681C68.6902 30.7111 68.4961 33.105 68.4961 35.6499Z" />
            <circle cx="83.8732" cy="45.7647" r="4.83096" />
            <circle cx="36.9439" cy="45.7647" r="4.83096" />
          </svg>
          <h2 tw="font-bold text-3xl m-0 text-white">ðŸ“š Voir toutes les fiches de</h2>
          <h1 tw="text-white font-bold text-5xl m-0">{universityName}</h1>
        </div>
      ),
      {
        width: 800,
        height: 400
      }
    );
  } catch (e: any) {
    console.log(`${e.message}`);
    return new Response(`Failed to generate the image`, {
      status: 500
    });
  }
}
